<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>BFilt: Terrain navigation</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.7 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
    <li>
      <form action="search.php" method="get">
        <table cellspacing="0" cellpadding="0" border="0">
          <tr>
            <td><label>&nbsp;<u>S</u>earch&nbsp;for&nbsp;</label></td>
            <td><input type="text" name="query" value="" size="20" accesskey="s"/></td>
          </tr>
        </table>
      </form>
    </li>
    </ul>
  </div>
</div>
<div class="contents">
<h1><a class="anchor" name="page_4">Terrain navigation </a></h1>This example illustrate performances of particle filter to highly non-linear filter. The promblem here involves a plane whose the trajectory is a brownian motion. This aircraft measure the elevation. The measure of this elevation and an elevation map are then used to estimate the position of the plane. <div align="center">
<img src="plane.gif" alt="plane.gif">
</div>
 <p>
plane.h <div class="fragment"><pre class="fragment"><span class="preprocessor">#ifndef __PLANE</span>
<span class="preprocessor"></span><span class="preprocessor">#define __PLANE</span>
<span class="preprocessor"></span>
<span class="preprocessor">#include &lt;bfilt/gaussian_model.h&gt;</span>

<span class="keyword">class </span>Plane : <span class="keyword">public</span> <a class="code" href="class_gaussian___nonlinear___model.html" title="Gaussian Nonlinear Model The state : X(k) = F (Xk-1, Wk) The Observation Y(k) = H...">Gaussian_Nonlinear_Model</a>
{
      vector&lt;double&gt; Map;
      <span class="keywordtype">double</span> xmin;
      <span class="keywordtype">double</span> xmax;
      <span class="keywordtype">double</span> ymin;
      <span class="keywordtype">double</span> ymax;

      <span class="keywordtype">double</span> sigv;
      <span class="keywordtype">double</span> sigc;
<span class="keyword">public</span> :
      Plane(<span class="keyword">const</span> <span class="keywordtype">char</span> *filename);

      dcovector State_Function(<span class="keyword">const</span> dcovector &amp;X, <span class="keyword">const</span> dcovector &amp;W);
      dcovector Observation_Function(<span class="keyword">const</span> dcovector &amp; X);
};


<span class="preprocessor">#endif</span>
</pre></div> plane.cpp <div class="fragment"><pre class="fragment"><span class="preprocessor">#include "plane.h"</span>

Plane::Plane(<span class="keyword">const</span> <span class="keywordtype">char</span> * filename)
{
      <span class="keywordtype">int</span> x,y,z;
      ifstream file(filename);

      <span class="keywordflow">if</span>(file)
            {
                              file&gt;&gt;xmax;
                              file&gt;&gt;ymin;
                              file&gt;&gt;z;
                              Map.push_back(z);

                  <span class="keywordflow">while</span>(!file.eof())
                        {
                              file&gt;&gt;x;
                              file&gt;&gt;y;
                              file&gt;&gt;z;
                              Map.push_back(z);

                              <span class="keywordflow">if</span>(x&gt;xmax)
                                    xmax=x;
                              <span class="keywordflow">if</span>(x&lt;xmin)
                                    xmin=x;
                              <span class="keywordflow">if</span>(y&gt;ymax)
                                    ymax=y;
                              <span class="keywordflow">if</span>(y&lt;ymin)
                                    ymin=y;
                              
                        }
                  file.close();
            }
      <span class="keywordflow">else</span> 
            {
                  cout&lt;&lt;<span class="stringliteral">"Plane :: error file"</span>&lt;&lt;endl;
            }

      Qw.resize(2);
      Qw.identity();
      Qv.resize(1);
      Qv.identity();
      Qv*=5.;
      R0.resize(4);
      R0.zero();
      R0(0,0)=10.;
      R0(1,1)=10.;
      R0(2,2) = .001;
      R0(3,3) = 0.0001;
      X0.resize(4);
      X0(0)=120.;
      X0(1)=20.;
      X0(2)=1.5;
      X0(3)=2.35;


      sigv = .001;
      sigc = 0.03;
            
}

dcovector <a class="code" href="class_gaussian___nonlinear___model.html#df0e6cf50a8d5fdb6decd05046867cd8" title="The state Xk=F(Xk-1,Wk).">Plane::State_Function</a>(<span class="keyword">const</span> dcovector &amp;X, <span class="keyword">const</span> dcovector &amp;W)
{
      dcovector U(4);

      U(0) = X(0) + X(2) * cos(X(3));
      U(1) = X(1) + X(2) * sin(X(3));
      U(2) = X(2) + sigv * W(0);
      U(3) = X(3) + sigc * W(1);
      <span class="keywordflow">if</span> (U(0)&gt;xmax)
            {
                  U(0)=xmax;
                  U(3)=3.14-U(3);
            }
      <span class="keywordflow">if</span> (U(1)&gt;ymax)
            {
                  U(1)=ymax;
                  U(3)=-U(3);
            }
      <span class="keywordflow">if</span> (U(0)&lt;xmin)
            {
                  U(0)=xmin;
                  U(3)=3.14-U(3);
            }
      <span class="keywordflow">if</span> (U(1)&lt;ymin)
            {
                  U(1)=ymin;
                  U(3)=-U(3);
            }

      <span class="keywordflow">return</span> U;
}
dcovector <a class="code" href="class_discrete___observed___model.html#8d56d86ea6b204672c8ebd720f1e11a6" title="The observation Yk=H(Xk) + Vk.">Plane::Observation_Function</a>(<span class="keyword">const</span> dcovector &amp; X)
{
      <span class="keywordtype">int</span> x = (int)(X(0));
      <span class="keywordtype">int</span> y = (int)(X(1));
      <span class="keywordtype">int</span> j= (xmax+1)*y + x;
      dcovector Y(1);
      Y(0)=Map[j];
      <span class="keywordflow">return</span> Y;
}

</pre></div> The main program : <div class="fragment"><pre class="fragment"><span class="preprocessor">#include &lt;bfilt/simulator.h&gt;</span>
<span class="preprocessor">#include &lt;bfilt/sisr_filter.h&gt;</span>
<span class="preprocessor">#include "plane.h"</span>

<span class="comment">// This example illustrate performances of particle filter to highly non-linear </span>
<span class="comment">// filter. The promblem here involves a plane whose the trajectory is a brownian</span>
<span class="comment">// motion. This aircraft measure the elevation. The measure of this elevation and </span>
<span class="comment">// an elevation map are then used to estimate the position of the plane.</span>
<span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv)
{
      <span class="keywordtype">int</span> k;
      <span class="keywordtype">int</span> i;
      <span class="keywordtype">int</span> j;
      vector&lt;Weighted_Sample&gt; cloud;

      ofstream file_c(<span class="stringliteral">"../data/cloud.dat"</span>); <span class="comment">// To save the cloud</span>
      ofstream file_s(<span class="stringliteral">"../data/state.dat"</span>); <span class="comment">// To save the state</span>

      Plane       plane(<span class="stringliteral">"../data/map_2.dat"</span>);       <span class="comment">// The plane model</span>
      <a class="code" href="class_g___simulator.html">G_Simulator</a> sim(&amp;plane);                    <span class="comment">// To simulate a this model</span>
      
      <a class="code" href="class_bootstrap___filter.html">Bootstrap_Filter</a> filter(100000,&amp;plane);       <span class="comment">// A bootstrap filter to estimate the position</span>

      sim.Simulate(150);                     <span class="comment">// simulation of 250 samples</span>

      sim.Save_Y(<span class="stringliteral">"../data/output.dat"</span>);     <span class="comment">// save the output</span>

      <span class="comment">// Here Init() and Update methods are used</span>
      <span class="comment">// for filtering because we want to get the cloud </span>
      <span class="comment">// at each step and save it in cloud.dat</span>

      filter.Init();                      <span class="comment">// Initialization of the boostrap filter</span>
      
      <span class="keywordflow">for</span> (k=0; k&lt;sim.Y.size(); k++)
            {

                  cloud=filter.CloudGet();              <span class="comment">// The current cloud is return</span>

                  <span class="keywordflow">for</span>(i=0; i&lt;cloud.size(); i++)         <span class="comment">// and here it is saved</span>
                        {
                              <span class="keywordflow">for</span>(j=0; j&lt;cloud[i].Value.l; j++)
                                    file_c&lt;&lt;cloud[i].Value(j)&lt;&lt;<span class="stringliteral">" "</span>;
                              file_c&lt;&lt;endl;
                        }

                  <span class="keywordflow">for</span> (j=0; j&lt;sim.X[k].l; j++)       <span class="comment">// The state is also saved</span>
                        file_s&lt;&lt;sim.X[k](j)&lt;&lt;<span class="stringliteral">" "</span>;
                  file_s&lt;&lt;endl&lt;&lt;endl&lt;&lt;endl;
                  file_c&lt;&lt;endl&lt;&lt;endl;

                  <span class="keywordflow">if</span>( filter.Update(sim.Y[k]))              <span class="comment">// The filter is then update with a new observation</span>
                        filter.Init();
            }
      file_c.close();
      file_s.close();

      <span class="keywordflow">return</span> 0;
}
</pre></div> </div>
<hr size="1"><address style="text-align: right;"><small>Generated on Wed Feb 25 15:15:36 2009 for BFilt by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.7 </small></address>
</body>
</html>
